<html lang="en">

<head>
    <title id="tab-title">Anna's Mod Interface</title>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Kalam&amp;display=swap" rel="stylesheet" />
</head>

<body>
    <script>
        let textDescriptionValid = false;
        let textColorValid = true;
        let textSizeValid = true;
        let textDescription;
        let textColor;
        let textSize;

        let timerDescriptionValid = false;
        let timerMinutesValid = false;
        let timerSecondsValid = false;
        let timerColorValid = true;
        let timerSizeValid = true;
        let timerDescription;
        let timerMinutes;
        let timerSeconds;
        let timerColor;
        let timerSize;


        window.addEventListener("load", (event) => {
            fetch("https://apoorlywrittenbot.cc/restricted/username", {
                method: 'GET'
            })
                .then(function (response) {
                    if (!response.ok) {
                        throw new Error("HTTP status " + response.status);
                    }
                    return response.json();
                })
                .then(function (data) {
                    let elem = document.getElementById("username");
                    elem.append(data["username"]);
                })

            const patterns = {
                nonEmpty: /^(?!\s*$).+/,
                hex: /^[0-9A-F]{6}$/i,
                positiveInteger: /^[1-9]\d*$/,
                nonNegative: /^\d+$/,
                sixty: /^([0-5]?[0-9])$/
            }

            timerDescription = document.getElementById("timerDescription");
            timerMinutes = document.getElementById("timerMinutes");
            timerSeconds = document.getElementById("timerSeconds");
            timerColor = document.getElementById("timerColor");
            timerSize = document.getElementById("timerSize");

            timerDescription.addEventListener('keyup', (e) => {
                if (patterns['nonEmpty'].test(timerDescription.value)) {
                    timerDescription.classList.remove("is-invalid");
                    timerDescriptionValid = true;
                } else {
                    timerDescription.classList.add("is-invalid");
                    timerDescriptionValid = false;
                }
            });

            timerMinutes.addEventListener('keyup', (e) => {
                if (patterns['nonNegative'].test(timerMinutes.value)) {
                    timerMinutes.classList.remove("is-invalid");
                    timerMinutesValid = true;
                } else {
                    timerMinutes.classList.add("is-invalid");
                    timerMinutesValid = false;
                }
            });

            timerSeconds.addEventListener('keyup', (e) => {
                if (patterns['sixty'].test(timerSeconds.value)) {
                    timerSeconds.classList.remove("is-invalid");
                    timerSecondsValid = true;
                } else {
                    timerSeconds.classList.add("is-invalid");
                    timerSecondsValid = false;
                }
            });

            timerColor.addEventListener('keyup', (e) => {
                if (patterns['hex'].test(timerColor.value)) {
                    timerColor.classList.remove("is-invalid");
                    timerColorValid = true;
                } else {
                    timerColor.classList.add("is-invalid");
                    timerColorValid = false;
                }
            });

            timerSize.addEventListener('keyup', (e) => {
                if (patterns['positiveInteger'].test(timerSize.value)) {
                    timerSize.classList.remove("is-invalid");
                    timerSizeValid = true;
                } else {
                    timerSize.classList.add("is-invalid");
                    timerSizeValid = false;
                }
            });

            textDescription = document.getElementById("textDescription");
            textColor = document.getElementById("textColor");
            textSize = document.getElementById("textSize");

            textDescription.addEventListener('keyup', (e) => {
                if (patterns['nonEmpty'].test(textDescription.value)) {
                    textDescription.classList.remove("is-invalid");
                    textDescriptionValid = true;
                } else {
                    textDescription.classList.add("is-invalid");
                    textDescriptionValid = false;
                }
            });

            textColor.addEventListener('keyup', (e) => {
                if (patterns['hex'].test(textColor.value)) {
                    textColor.classList.remove("is-invalid");
                    textColorValid = true;
                } else {
                    textColor.classList.add("is-invalid");
                    textColorValid = false;
                }
            });

            textSize.addEventListener('keyup', (e) => {
                if (patterns['positiveInteger'].test(textSize.value)) {
                    textSize.classList.remove("is-invalid");
                    textSizeValid = true;
                } else {
                    textSize.classList.add("is-invalid");
                    textSizeValid = false;
                }
            });
        });

        const alert = (message, type) => {
            const wrapper = document.createElement('div')
            wrapper.innerHTML = [
                `<div class="alert alert-${type} alert-dismissible" role="alert" style="z-index:99;">`,
                `   <div>${message}</div>`,
                '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
                '</div>'
            ].join('');

            let alertPlaceholder = document.getElementById('liveAlertPlaceholder');
            alertPlaceholder.append(wrapper);
        }

        function submitTimerForm() {
            event.preventDefault();
            if (!timerDescriptionValid || !timerMinutesValid || !timerSecondsValid || !timerColorValid || !timerSizeValid) {
                alert("The form contains invalid values", "warning");
                return false;
            }

            let payload = {
                content: timerDescription.value,
                duration: (parseInt(timerMinutes.value)*60+parseInt(timerSeconds.value)) | 0,
                color: timerColor.value,
                size: timerSize.value
            };

            fetch("https://apoorlywrittenbot.cc/restricted/annaagtapp/timer", {
                method: 'POST',
                body: JSON.stringify(payload)
            })
                .then(function (response) {
                    if (!response.ok) {
                        alert(`Error: Status ${String(response.status)}`, 'danger');
                        throw new Error("HTTP status " + response.status);
                    }
                    return response.json();
                })
                .then(function (data) {
                    alert("Submitted successfully", "success");
                })
        }

        function submitTextForm() {
            event.preventDefault();
            if (!textDescriptionValid || !textColorValid || !textSizeValid) {
                alert("The form contains invalid values", "warning");
                return false;
            }

            let payload = {
                content: textDescription.value,
                color: textColor.value,
                size: textSize.value
            };

            fetch("https://apoorlywrittenbot.cc/restricted/annaagtapp/text", {
                method: 'POST',
                body: JSON.stringify(payload)
            })
                .then(function (response) {
                    if (!response.ok) {
                        alert(`Error: Status ${String(response.status)}`, 'danger');
                        throw new Error("HTTP status " + response.status);
                    }
                    return response.json();
                })
                .then(function (data) {
                    alert("Submitted successfully", "success");
                })

        }

        function clearAll() {
            fetch("https://apoorlywrittenbot.cc/restricted/annaagtapp/clearall", {
                method: 'POST',
                body: JSON.stringify({})
            })
                .then(function (response) {
                    if (!response.ok) {
                        alert(`Error: Status ${String(response.status)}`, 'danger');
                        throw new Error("HTTP status " + response.status);
                    }
                    return response.json();
                })
                .then(function (data) {
                    alert("Submitted successfully", "success");
                })
        }
    </script>
    <div id="liveAlertPlaceholder" style="position:fixed; top: 0px; width: 100%;"></div>
    <div class="container-fluid p-5">
        <h1 class="display-2 text-center" style="font-family: 'Kalam', cursive;">Anna's Mod Interface</h1>
        <h6 class="display-9 text-center" style="font-family: 'Kalam', cursive;" id="username">Logged in as: </h6>

        <form class="row g-3" id="timerForm" onsubmit="submitTimerForm(); return false">
            <div class="col-12">
                <label for="timerDescription" class="form-label">Add Timer Text</label>
                <input type="text" class="form-control needs-validation" id="timerDescription" placeholder="Wig">
                <small id="timerDescriptionValid" class="form-text text-danger invalid-feedback">Invalid Input</small>
            </div>
            <div class="col-md-6">
                <label for="timerMinutes" class="form-label">Minutes</label>
                <input type="text" class="form-control needs-validation" id="timerMinutes" placeholder="5">
                <small id="timerMinutesValid" class="form-text text-danger invalid-feedback">Invalid Input</small>
            </div>
            <div class="col-md-6">
                <label for="timerSeconds" class="form-label">Seconds</label>
                <input type="text" class="form-control needs-validation" id="timerSeconds" placeholder="0">
                <small id="timerSecondsValid" class="form-text text-danger invalid-feedback">Invalid Input</small>
            </div>
            <div class="col-md-4">
                <label for="timerColor" class="form-label">Font Color</label>
                <div class="input-group">
                    <span class="input-group-text" id="inputGroupPrepend">#</span>
                    <input type="text" class="form-control needs-validation" id="timerColor"
                        aria-describedby="inputGroupPrepend" placeholder="FFFFFF" value="FFFFFF">
                    <small id="timerColorValid" class="form-text text-danger invalid-feedback">Invalid Input</small>
                </div>
            </div>
            <div class="col-md-4">
                <label for="timerSize" class="form-label">Font Size</label>
                <div class="input-group">
                    <input type="text" class="form-control needs-validation" id="timerSize"
                        aria-describedby="inputGroupPostpend" placeholder="30" value="30">
                    <span class="input-group-text" id="inputGroupPostpend">px</span>
                    <small id="timerSizeValid" class="form-text text-danger invalid-feedback">Invalid Input</small>
                </div>
            </div>
            <div class="col-12">
                <button type="submit" class="btn btn-primary" id="timerSubmitButton">Create Timer</button>
            </div>
        </form>

        <form id="textForm" class="row g-3" novalidate onsubmit="submitTextForm();">
            <div class="mb-3">
                <label for="textDescription" class="form-label">Add Plain Text</label>
                <input type="text" class="form-control needs-validation" id="textDescription"
                    placeholder="Plain text to be added">
                <small id="textDescriptionValid" class="form-text text-danger invalid-feedback">Invalid Input</small>
            </div>
            <div class="col-md-4">
                <label for="textColor" class="form-label">Font Color</label>
                <div class="input-group">
                    <span class="input-group-text" id="inputGroupPrepend">#</span>
                    <input type="text" class="form-control needs-validation" id="textColor"
                        aria-describedby="inputGroupPrepend" placeholder="FFFFFF" value="FFFFFF">
                    <small id="textColorValid" class="form-text text-danger invalid-feedback">Invalid Input</small>
                </div>
            </div>
            <div class="col-md-4">
                <label for="textSize" class="form-label">Font Size</label>
                <div class="input-group">
                    <input type="text" class="form-control needs-validation" id="textSize"
                        aria-describedby="inputGroupPostpend" placeholder="30" value="30">
                    <span class="input-group-text" id="inputGroupPostpend">px</span>
                    <small id="textSizeValid" class="form-text text-danger invalid-feedback">Invalid Input</small>
                </div>
            </div>
            <div class="col-12">
                <button type="submit" class="btn btn-primary" id="textSubmitButton">Add Text</button>
            </div>
        </form>
    </div>
    <div class="d-grid gap-2">
        <button type="button" class="btn btn-primary rounded-0" onclick="clearAll();"
            style="color: white; background-color: #078448; font-family: 'Kalam', cursive; font-size: 30px; position:fixed; bottom: 0px; width: 100%; z-index: 999;">
            Clear All</button>
    </div>
</body>

</html>